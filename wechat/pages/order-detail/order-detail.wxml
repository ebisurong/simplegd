<!--pages/order-detail/order-detail.wxml-->
<view class="page-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">å·¥å•è¯¦æƒ…</view>
    <view class="page-desc">å·¥å•å·ï¼š{{orderData.id}}</view>
  </view>

  <!-- å·¥å•çŠ¶æ€ -->
  <view class="card mb-20">
    <view class="card-content">
      <view class="status-section">
        <view class="status-main">
          <view class="status status-{{orderData.status}} status-large">{{orderData.statusText}}</view>
          <view class="status-time">{{orderData.createTime}}</view>
        </view>
        <view class="status-icon">
          <text class="status-emoji">{{statusEmoji}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="card mb-20">
    <view class="card-header">
      <view class="card-title">åŸºæœ¬ä¿¡æ¯</view>
    </view>
    <view class="card-content">
      <!-- <view class="info-item">
        <view class="info-label">å·¥å•æ ‡é¢˜</view>
        <view class="info-value">{{orderData.title}}</view>
      </view>
       -->
      <view class="info-item">
        <!-- <view class="info-label">é—®é¢˜æè¿°</view> -->
        <view class="info-value info-desc">{{orderData.description}}</view>
      </view>
      
      <!-- <view class="info-item">
        <view class="info-label">ä¼˜å…ˆçº§</view>
        <view class="info-value">
          <view class="priority priority-{{orderData.priority}}">{{priorityText}}</view>
        </view>
      </view> -->
      
      <view class="info-item" wx:if="{{orderData.contact}}">
        <view class="info-label">è”ç³»äºº</view>
        <view class="info-value">{{orderData.contact}}</view>
      </view>
      
      <view class="info-item" wx:if="{{orderData.phone}}">
        <view class="info-label">è”ç³»ç”µè¯</view>
        <view class="info-value">
          <text class="phone-number" bindtap="callPhone" data-phone="{{orderData.phone}}">{{orderData.phone}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä½ç½®ä¿¡æ¯ -->
  <view class="card mb-20">
    <view class="card-header">
      <view class="card-title">ä½ç½®ä¿¡æ¯</view>
    </view>
    <view class="card-content">
      <view class="info-item">
        <view class="info-label">é¡¹ç›®åç§°</view>
        <view class="info-value">{{orderData.projectName}}</view>
      </view>
      
      <view class="info-item">
        <view class="info-label">åœ°ç‚¹åç§°</view>
        <view class="info-value">{{orderData.locationName}}</view>
      </view>
      
      <view class="info-item" wx:if="{{orderData.location}}">
        <view class="info-label">GPSåæ ‡</view>
        <view class="info-value">
          <text class="location-coords" bindtap="openLocation">{{orderData.location.latitude}}, {{orderData.location.longitude}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç°åœºç…§ç‰‡ -->
  <view class="card mb-20" wx:if="{{orderData.photos && orderData.photos.length > 0}}">
    <view class="card-header">
      <view class="card-title">ç°åœºç…§ç‰‡</view>
      <view class="photo-count">å…±{{orderData.photos.length}}å¼ </view>
    </view>
    <view class="card-content">
      <view class="photo-gallery">
        <view class="photo-item" wx:for="{{orderData.photos}}" wx:key="timestamp" bindtap="previewPhoto" data-index="{{index}}">
          <image src="{{item.path}}" mode="aspectFill" class="photo-image"></image>
          <view class="photo-watermark-badge" wx:if="{{item.hasWatermark}}">
            <text class="watermark-icon">ğŸ’§</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <!-- <view class="action-section">
    <button class="btn btn-secondary action-btn" bindtap="editOrder" wx:if="{{canEdit}}">
      <text class="btn-icon">âœï¸</text>
      ç¼–è¾‘å·¥å•
    </button>
    
    <button class="btn btn-primary action-btn" bindtap="shareOrder">
      <text class="btn-icon">ğŸ“¤</text>
      åˆ†äº«å·¥å•
    </button>
  </view> -->

  <!-- æ—¶é—´çº¿ï¼ˆå¦‚æœæœ‰å¤„ç†è®°å½•ï¼‰ -->
  <view class="card mb-20" wx:if="{{timeline && timeline.length > 0}}">
    <view class="card-header">
      <view class="card-title">å¤„ç†è®°å½•</view>
    </view>
    <view class="card-content">
      <view class="timeline">
        <view class="timeline-item" wx:for="{{timeline}}" wx:key="id">
          <view class="timeline-dot timeline-dot-{{item.type}}"></view>
          <view class="timeline-content">
            <view class="timeline-title">{{item.title}}</view>
            <view class="timeline-desc" wx:if="{{item.description}}">{{item.description}}</view>
            <view class="timeline-time">{{item.time}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- å›¾ç‰‡é¢„è§ˆå¼¹çª— -->
<view class="image-modal" wx:if="{{showImageModal}}" bindtap="closeImageModal">
  <view class="image-modal-content" catchtap="stopPropagation">
    <view class="image-modal-header">
      <text class="image-modal-title">å›¾ç‰‡é¢„è§ˆ ({{currentImageIndex + 1}}/{{modalImages.length}})</text>
      <text class="image-modal-close" bindtap="closeImageModal">Ã—</text>
    </view>
    <view class="image-modal-body">
      <swiper class="image-swiper" current="{{currentImageIndex}}" bindchange="onImageSwiperChange">
        <swiper-item wx:for="{{modalImages}}" wx:key="index">
          <image class="modal-image" src="{{item}}" mode="aspectFit" />
        </swiper-item>
      </swiper>
    </view>
    <!-- å›¾ç‰‡è·¯å¾„æ˜¾ç¤ºåŒºåŸŸ -->
    <view class="image-path-section">
      <view class="image-path-label">å›¾ç‰‡è·¯å¾„:</view>
      <view class="image-path-content">
        <text class="image-path-text" selectable="true">{{modalImages[currentImageIndex]}}</text>
        <text class="copy-path-btn" bindtap="copyImagePath" data-path="{{modalImages[currentImageIndex]}}">å¤åˆ¶</text>
      </view>
    </view>
    <view class="image-modal-footer" wx:if="{{modalImages.length > 1}}">
      <view class="image-dots">
        <view class="dot {{index === currentImageIndex ? 'active' : ''}}" 
              wx:for="{{modalImages}}" wx:key="index" 
              bindtap="switchToImage" data-index="{{index}}"></view>
      </view>
    </view>
  </view>
</view>

<!-- åˆ†äº«å¼¹çª— -->
<!-- <view class="modal" wx:if="{{showShareModal}}" bindtap="hideShareModal">
  <view class="modal-content share-modal" catchtap="stopPropagation">
    <view class="modal-header">
      <view class="modal-title">åˆ†äº«å·¥å•</view>
      <view class="modal-close" bindtap="hideShareModal">Ã—</view>
    </view>
    <view class="modal-body">
      <view class="share-options">
        <button class="share-option" open-type="share">
          <view class="share-icon wechat-icon">ğŸ’¬</view>
          <view class="share-text">å¾®ä¿¡å¥½å‹</view>
        </button>
        
        <view class="share-option" bindtap="copyOrderInfo">
          <view class="share-icon copy-icon">ğŸ“‹</view>
          <view class="share-text">å¤åˆ¶ä¿¡æ¯</view>
        </view>
        
        <view class="share-option" bindtap="saveToAlbum">
          <view class="share-icon save-icon">ğŸ’¾</view>
          <view class="share-text">ä¿å­˜å›¾ç‰‡</view>
        </view>
      </view>
    </view>
  </view>
</view> -->