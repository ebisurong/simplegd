# 工单管理后台系统规划文档

## 1. 项目概述

基于现有工单管理小程序，设计开发一个简洁实用的后台管理系统，主要用于演示和管理工单数据。系统将提供工单管理、用户管理、数据统计等核心功能，采用轻量级技术栈，注重开发效率和演示效果。

## 2. 功能模块规划

### 2.1 用户角色

| 角色 | 权限说明 | 主要功能 |
|------|----------|----------|
| 超级管理员 | 系统最高权限 | 用户管理、系统配置、数据统计 |
| 工单管理员 | 工单处理权限 | 工单审核、分配、处理、回复 |
| 普通用户 | 基础查看权限 | 查看工单列表、基础统计 |

### 2.2 核心功能模块

#### 2.2.1 仪表盘
- 工单统计概览（总数、待处理、已完成、紧急工单）
- 施工阶段分布图表
- 优先级分布统计
- 最近工单动态
- 系统运行状态

#### 2.2.2 工单管理
- 工单列表（支持筛选、搜索、分页）
- 工单详情查看
- 工单状态管理（待处理、处理中、已完成、已关闭）
- 工单分配（指派处理人员）
- 工单回复和备注
- 批量操作（批量分配、批量状态更新）

#### 2.2.3 用户管理
- 用户列表管理
- 用户信息编辑
- 角色权限分配
- 用户状态管理（启用/禁用）

#### 2.2.4 数据统计
- 工单趋势分析（按时间、施工阶段、优先级）
- 处理效率统计
- 用户活跃度分析
- 导出统计报表

#### 2.2.5 系统设置
- 基础配置管理
- 施工阶段配置
- 优先级配置
- 系统参数设置

## 3. 技术栈选择

### 3.1 前端技术栈
- **框架**: Vue 3 + Vite
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **路由**: Vue Router 4
- **HTTP客户端**: Axios
- **图表库**: ECharts
- **样式**: SCSS

### 3.2 后端技术栈
- **框架**: Node.js + Express
- **数据库**: SQLite（轻量级，适合演示）
- **ORM**: Sequelize
- **身份验证**: JWT
- **文件上传**: Multer
- **API文档**: Swagger

### 3.3 开发工具
- **代码管理**: Git
- **API测试**: Postman
- **数据库管理**: DB Browser for SQLite

## 4. 数据库设计

### 4.1 数据表结构

#### 用户表 (users)
```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  email VARCHAR(100),
  real_name VARCHAR(50),
  role ENUM('admin', 'manager', 'user') DEFAULT 'user',
  status ENUM('active', 'inactive') DEFAULT 'active',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### 工单表 (work_orders)
```sql
CREATE TABLE work_orders (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title VARCHAR(200) NOT NULL,
  description TEXT NOT NULL,
  priority ENUM('low', 'medium', 'high', 'urgent') DEFAULT 'medium',
  construction_stage ENUM('preparation', 'foundation', 'structure', 'decoration', 'equipment', 'completion') NOT NULL,
  status ENUM('pending', 'processing', 'completed', 'closed') DEFAULT 'pending',
  contact_name VARCHAR(50),
  contact_phone VARCHAR(20),
  project_name VARCHAR(100),
  location_name VARCHAR(200),
  gps_latitude DECIMAL(10, 8),
  gps_longitude DECIMAL(11, 8),
  submitter_id INTEGER,
  assignee_id INTEGER,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (submitter_id) REFERENCES users(id),
  FOREIGN KEY (assignee_id) REFERENCES users(id)
);
```

#### 工单照片表 (work_order_photos)
```sql
CREATE TABLE work_order_photos (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  work_order_id INTEGER NOT NULL,
  photo_url VARCHAR(500) NOT NULL,
  has_watermark BOOLEAN DEFAULT FALSE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (work_order_id) REFERENCES work_orders(id) ON DELETE CASCADE
);
```

#### 工单日志表 (work_order_logs)
```sql
CREATE TABLE work_order_logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  work_order_id INTEGER NOT NULL,
  user_id INTEGER NOT NULL,
  action VARCHAR(50) NOT NULL,
  content TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (work_order_id) REFERENCES work_orders(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

#### 系统配置表 (system_configs)
```sql
CREATE TABLE system_configs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  config_key VARCHAR(100) UNIQUE NOT NULL,
  config_value TEXT,
  description VARCHAR(200),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## 5. API接口规划

### 5.1 认证接口
```
POST /api/auth/login     # 用户登录
POST /api/auth/logout    # 用户登出
GET  /api/auth/profile   # 获取用户信息
```

### 5.2 工单管理接口
```
GET    /api/work-orders           # 获取工单列表
GET    /api/work-orders/:id       # 获取工单详情
PUT    /api/work-orders/:id       # 更新工单信息
PUT    /api/work-orders/:id/status # 更新工单状态
PUT    /api/work-orders/:id/assign # 分配工单
POST   /api/work-orders/:id/logs  # 添加工单日志
GET    /api/work-orders/:id/logs  # 获取工单日志
```

### 5.3 用户管理接口
```
GET    /api/users        # 获取用户列表
GET    /api/users/:id    # 获取用户详情
POST   /api/users        # 创建用户
PUT    /api/users/:id    # 更新用户信息
DELETE /api/users/:id    # 删除用户
```

### 5.4 统计分析接口
```
GET /api/statistics/dashboard    # 仪表盘统计数据
GET /api/statistics/trends       # 工单趋势分析
GET /api/statistics/stages       # 施工阶段统计
GET /api/statistics/priorities   # 优先级统计
```

### 5.5 系统配置接口
```
GET /api/configs         # 获取系统配置
PUT /api/configs         # 更新系统配置
```

## 6. 页面设计规划

### 6.1 页面路由结构
```
/login                   # 登录页
/dashboard              # 仪表盘
/work-orders            # 工单列表
/work-orders/:id        # 工单详情
/users                  # 用户管理
/statistics             # 数据统计
/settings               # 系统设置
```

### 6.2 UI设计风格
- **主色调**: 蓝色系 (#409EFF)
- **辅助色**: 绿色 (#67C23A)、橙色 (#E6A23C)、红色 (#F56C6C)
- **布局**: 左侧导航 + 顶部面包屑 + 主内容区
- **组件**: Element Plus 标准组件
- **图标**: Element Plus Icons

## 7. 开发计划

### 7.1 第一阶段（基础功能）
- 项目初始化和环境搭建
- 用户认证系统
- 基础页面布局
- 工单列表和详情页面

### 7.2 第二阶段（核心功能）
- 工单管理功能完善
- 用户管理模块
- 基础统计功能

### 7.3 第三阶段（增强功能）
- 数据统计图表
- 系统配置管理
- 功能优化和测试

## 8. 部署方案

### 8.1 开发环境
- 前端: npm run dev (Vite开发服务器)
- 后端: npm run dev (nodemon热重载)
- 数据库: 本地SQLite文件

### 8.2 演示部署
- 前端: 静态文件部署（Nginx或CDN）
- 后端: Node.js服务器（PM2管理）
- 数据库: SQLite文件部署

## 9. 部署优化

### 9.1 开发环境配置
- 支持热重载开发
- 自动数据库初始化
- 统一的启动脚本

### 9.2 生产环境考虑
- 静态文件服务
- 数据库备份策略
- 日志记录机制

## 10. 扩展性考虑

虽然当前设计注重简洁和演示效果，但保留了以下扩展空间：
- 数据库可轻松迁移到MySQL/PostgreSQL
- 支持微服务架构拆分
- 可集成消息队列和缓存
- 支持多租户架构
- 可扩展移动端管理应用